# ProjectDetail v2 - 画布式资源管理

这是 ProjectDetail 组件的重构版本，实现了基于 ReactFlow 的可视化资源管理界面，采用类似 macOS Finder 的设计理念。

## 主要特性

### 🎨 画布式界面
- 使用 ReactFlow 实现可视化画布
- 支持拖拽、缩放、平移等交互
- 节点间的连接关系可视化
- 小地图和控制面板

### 📊 三种视图模式
- **画布视图**: 可视化展示资源关系和状态
- **列表视图**: 传统的列表形式展示（开发中）
- **网格视图**: 卡片网格形式展示（开发中）

### 🏗️ 资源管理架构
```
Project (项目)
├── Group (组)
│   ├── Host (主机)
│   └── PortForward (端口转发)
└── Group (组)
    ├── Host (主机)
    └── PortForward (端口转发)
```

### 🎯 核心功能

#### 1. 组管理 (Group CRUD)
- ✅ 可视化创建组节点
- ✅ 编辑组信息
- ✅ 删除组（含确认）
- ✅ 组内资源统计

#### 2. 主机管理 (Host CRUD)
- ✅ 在组内创建主机
- ✅ 主机连接状态显示
- ✅ 编辑主机配置
- ✅ 删除主机

#### 3. 端口转发管理 (Port Forward CRUD)
- ✅ 创建端口转发规则
- ✅ 支持本地/远程/动态转发
- ✅ 启动/停止转发
- ✅ 编辑转发配置

### 🎨 节点设计

#### Group 节点
- 显示组名称和描述
- 资源统计（主机数、端口数、活跃连接）
- 标签显示
- 快速操作按钮
- 颜色自定义

#### Host 节点
- 主机基本信息
- 连接状态指示器
- 认证方式显示
- 连接次数统计
- 标签支持

#### Port 节点
- 端口转发类型图标
- 本地/远程端口信息
- 转发状态指示
- 自动启动标识
- 控制按钮

### 🔧 技术实现

#### 核心依赖
- `@xyflow/react`: ReactFlow 画布框架
- `@tanstack/react-query`: 数据获取和状态管理
- `zustand`: 客户端状态管理
- `shadcn/ui`: UI 组件库

#### 组件结构
```
ProjectDetail.v2.tsx           # 主组件
├── canvas/
│   ├── ProjectCanvas.tsx      # 画布容器
│   ├── GroupNode.tsx          # 组节点
│   ├── HostNode.tsx           # 主机节点
│   ├── PortNode.tsx           # 端口节点
│   ├── CanvasContextMenu.tsx  # 右键菜单
│   └── types.ts               # 类型定义
└── dialogs/
    ├── GroupDialog.tsx        # 组编辑对话框
    ├── HostDialog.tsx         # 主机编辑对话框
    └── PortForwardDialog.tsx  # 端口转发对话框
```

### 🚀 使用方法

```tsx
import { ProjectDetailV2 } from './ProjectDetail.v2';

function App() {
  return (
    <ProjectDetailV2 
      project={projectData}
      stats={projectStats}
      onGroupClick={(group) => console.log('Group clicked:', group)}
    />
  );
}
```

### 🎯 交互特性

#### 画布操作
- **鼠标滚轮**: 缩放画布
- **拖拽**: 移动画布视角
- **节点拖拽**: 重新排列节点位置
- **右键菜单**: 创建、编辑、删除操作

#### 工具栏功能
- **创建按钮**: 快速创建组、主机、端口
- **自动布局**: 重新整理节点排列
- **重置视图**: 回到初始视角
- **统计面板**: 实时显示资源统计

#### 状态指示
- **连接状态**: 主机连接状态实时显示
- **转发状态**: 端口转发活跃状态
- **动画效果**: 活跃连接的动画指示

### 🔄 数据流

#### API 集成
- 使用 TanStack Query 管理服务器状态
- 自动缓存和重新验证
- 乐观更新支持
- 错误处理

#### 状态管理
- 本地 UI 状态（视图模式、对话框状态）
- 服务器状态（项目数据、资源列表）
- 画布状态（节点位置、选中状态）

### 🎨 设计理念

#### macOS Finder 风格
- 清晰的层级结构
- 直观的图标和颜色
- 流畅的交互动画
- 一致的视觉语言

#### 响应式设计
- 支持不同屏幕尺寸
- 自适应布局
- 移动端友好

### 📋 开发计划

#### 已完成 ✅
- [x] 画布基础框架
- [x] 三种节点类型
- [x] CRUD 对话框
- [x] 右键菜单
- [x] 基本交互

#### 进行中 🚧
- [ ] 列表视图实现
- [ ] 网格视图实现
- [ ] 高级布局算法
- [ ] 性能优化

#### 计划中 📅
- [ ] 拖拽创建节点
- [ ] 批量操作
- [ ] 导入/导出功能
- [ ] 快捷键支持
- [ ] 主题切换
- [ ] 国际化

### 🧪 测试

可以使用 `ProjectDetail.v2.test.tsx` 文件进行组件测试，包含完整的模拟数据。

```bash
# 运行开发服务器
bun run dev

# 访问测试页面
# /projects/test (需要配置路由)
```

### 🤝 贡献

欢迎提交 Issue 和 Pull Request 来改进这个组件！

主要改进方向：
- 性能优化
- 用户体验提升
- 新功能实现
- Bug 修复
